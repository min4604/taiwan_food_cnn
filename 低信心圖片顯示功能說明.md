# 🔍 低信心圖片自動顯示功能

## 📋 功能說明

現在 `evaluate_test_set.py` 具備自動挑選並顯示**預測信心分數較低**的圖片功能！

### 🎯 主要特性

1. **信心分數計算**: 使用 softmax 最大值作為預測信心分數
2. **自動篩選**: 挑選信心分數低於門檻值的圖片
3. **自動開啟**: 使用 Windows 預設圖片檢視器自動開啟
4. **詳細資訊**: 顯示圖片編號、預測類別、信心分數和路徑

## 🔧 設定參數

### 預設設定
```python
threshold = 0.5    # 信心分數門檻（低於此值視為低信心）
max_show = 10      # 最多顯示圖片數量
```

### 可調整參數
- **門檻值**: 0.1 ~ 0.9（建議 0.3 ~ 0.7）
- **顯示數量**: 1 ~ 50（建議 5 ~ 15）

## 🚀 使用方法

### 自動模式
```bash
python evaluate_test_set.py
```

### 手動硬體選擇模式
```bash
python manual_hardware_selection.py
# 選擇：1. 高效能模式 (支援信心分數)
```

### 測試功能
```bash
python test_confidence_feature.py
```

## 📊 輸出範例

### 終端機顯示
```
🔍 發現 3 張預測信心低於 0.5 的圖片：
============================================================
  📷 圖片編號: 42
  🎯 預測類別: 15
  📊 信心分數: 0.234
  📁 路徑: archive/tw_food_101/test/42.jpg
----------------------------------------
  ✅ 已開啟圖片檢視器

  📷 圖片編號: 127
  🎯 預測類別: 83
  📊 信心分數: 0.387
  📁 路徑: archive/tw_food_101/test/127.jpg
----------------------------------------
  ✅ 已開啟圖片檢視器

🎯 已自動開啟 3 張低信心圖片供檢視
```

### CSV 檔案輸出
檔案：`test_predictions_optimized_amd_npu.csv`
```csv
Id,Category,Confidence,Path
0,25,0.8234,archive/tw_food_101/test/0.jpg
1,67,0.9123,archive/tw_food_101/test/1.jpg
42,15,0.2340,archive/tw_food_101/test/42.jpg
127,83,0.3870,archive/tw_food_101/test/127.jpg
```

## 🔍 信心分數解釋

### 分數範圍與意義
- **0.9 ~ 1.0**: 非常高信心 ✅
- **0.7 ~ 0.9**: 高信心 ✅
- **0.5 ~ 0.7**: 中等信心 ⚠️
- **0.3 ~ 0.5**: 低信心 🔍
- **0.0 ~ 0.3**: 非常低信心 ❌

### 低信心原因分析
1. **圖片品質問題**: 模糊、光線不足、角度特殊
2. **類別相似性**: 食物外觀相似，難以區分
3. **訓練資料不足**: 該類別訓練樣本較少
4. **拍攝環境**: 背景複雜、遮擋、變形

## 🛠️ 進階設定

### 修改門檻值
編輯 `evaluate_test_set.py` 第 330 行左右：
```python
threshold = 0.3  # 更嚴格的門檻（顯示更多圖片）
threshold = 0.7  # 更寬鬆的門檻（只顯示最低信心）
```

### 修改顯示數量
```python
max_show = 5   # 只顯示前5張
max_show = 20  # 顯示前20張
```

### 關閉自動開啟
註解掉開啟圖片的程式碼：
```python
# subprocess.Popen(['start', '', path], shell=True)
```

## 📈 應用場景

### 模型改進
- 分析低信心圖片找出模型弱點
- 針對性收集更多訓練資料
- 調整資料增強策略

### 品質控制
- 檢查測試資料品質
- 發現標註錯誤
- 識別邊界案例

### 模型驗證
- 評估模型可靠性
- 設定信心門檻
- 建立拒絕機制

## 🔧 故障排除

### 圖片無法開啟
1. 檢查 Windows 預設圖片檢視器
2. 確認圖片檔案存在且完整
3. 檢查檔案權限

### 沒有低信心圖片
- 降低門檻值（如 0.3）
- 檢查模型是否過度訓練
- 確認測試資料多樣性

### 信心分數為 0
- 檢查是否使用最佳化推理引擎
- 確認 softmax 計算正確
- 驗證模型輸出格式

## 💡 最佳實踐

1. **合理設定門檻**: 根據應用需求調整
2. **限制顯示數量**: 避免開啟過多圖片
3. **定期檢視**: 用於模型改進和資料品質控制
4. **記錄分析**: 統計低信心圖片的分佈和特徵

---

**享受更智慧的模型評估體驗！** 🚀✨